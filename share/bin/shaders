#!/usr/bin/env sh

scrDir=$(dirname "$(realpath "$0")")
source "$scrDir"/globalcontrol
rofiConf="${confDir}/rofi/quickapps.rasi"

[[ $rofiScale =~ ^[0-9]+$ ]] || rofiScale=10
r_scale="configuration {font: \"Monocraft ${rofiScale}\";}"
r_override="window {height: 18em; width: 14em; y-offset: 0em; border: ${hypr_width}px; border-radius: 0;} element {border-radius: 0;}"

shaderStatus=$(hyprshade current)
shaderList=$(ls "$confDir/hypr/shaders" | sed 's/\.[^.]*$//')

if [[ $shaderStatus == "" ]]; then
        # If no shader is active, offer "Toggle" as the first option
        selectedOption=$(echo -e "Enable\n$shaderList" | rofi -dmenu -theme-str "$r_override" -theme-str "$r_scale" -config "$rofiConf")
else
        # If a shader is active, offer "Disable" as the first option
        selectedOption=$(echo -e "Disable\n$shaderList" | rofi -dmenu -theme-str "$r_override" -theme-str "$r_scale" -config "$rofiConf")
fi

if [ "$selectedOption" = "" ]; then
        exit
fi

case $1 in
        list)
                if [ "$selectedOption" = "Disable" ]; then
                        hyprshade off
                elif [ "$selectedOption" = "Enable" ]; then
                        last_shader=$(tail -n 1 "$confDir/hypr/shaders/.last_shader.txt")
                        hyprshade on "$last_shader"
                else
                        hyprshade on "$selectedOption"

                        echo "$selectedOption" >"$confDir/hypr/shaders/.last_shader.txt"
                fi
                ;;
        night)
                if pgre -x "hyprshade" >/dev/null; then
                        pkill --signal SIGTERM -x hyprshade
                else
                        hyprshade "$(echo -e "$shaderList" | grep 'dark')"
                fi
                ;;
esac

shaderStatus=$(hyprshade current)
notify-send "Shader: $shaderStatus"
